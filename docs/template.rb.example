# è¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„ Homebrew Formula æ¨¡æ¿ç¤ºä¾‹æ–‡ä»¶
# ä½¿ç”¨æ–¹æ³•ï¼š
# 1. å¤åˆ¶è¿™ä¸ªæ–‡ä»¶å¹¶é‡å‘½åä¸ºä½ çš„åº”ç”¨åç§°ï¼ˆå°å†™+è¿å­—ç¬¦ï¼‰
#    ä¾‹å¦‚ï¼šcp template.rb.example my-app.rb
# 2. å°† "MyApp" æ›¿æ¢ä¸ºä½ çš„åº”ç”¨ç±»åï¼ˆé©¼å³°å‘½åæ³•ï¼‰
# 3. å¡«å…¥å®é™…çš„é¡¹ç›®ä¿¡æ¯ï¼ˆURLã€SHA256ã€æè¿°ç­‰ï¼‰
# 4. æ ¹æ®éœ€è¦ä¿®æ”¹ install å’Œ test æ–¹æ³•

class MyApp < Formula
  # ç®€çŸ­çš„ä¸€å¥è¯æè¿°ï¼ˆå¿…å¡«ï¼‰
  # æè¿°åº”è¯¥æ¸…æ™°è¯´æ˜è¿™ä¸ªå·¥å…·æ˜¯åšä»€ä¹ˆçš„
  desc "A simple command-line tool for doing something awesome"

  # é¡¹ç›®ä¸»é¡µ URLï¼ˆå¿…å¡«ï¼‰
  # é€šå¸¸æ˜¯ GitHub ä»“åº“åœ°å€æˆ–é¡¹ç›®å®˜ç½‘
  homepage "https://github.com/username/my-app"

  # ä¸‹è½½åœ°å€ï¼ˆå¿…å¡«ï¼‰
  # è¿™é‡Œä½¿ç”¨ç‰ˆæœ¬å˜é‡ #{version}ï¼Œæ–¹ä¾¿ç‰ˆæœ¬æ›´æ–°
  url "https://github.com/username/my-app/releases/download/v1.0.0/my-app-1.0.0.tar.gz"

  # æ–‡ä»¶çš„ SHA256 æ ¡éªŒå’Œï¼ˆå¿…å¡«ï¼‰
  # ä½¿ç”¨å‘½ä»¤è·å–ï¼šshasum -a 256 <ä¸‹è½½çš„æ–‡ä»¶>
  # è¿™ç¡®ä¿ä¸‹è½½çš„æ–‡ä»¶æ²¡æœ‰è¢«ç¯¡æ”¹
  sha256 "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"

  # è½¯ä»¶è®¸å¯è¯ï¼ˆæ¨èï¼‰
  # å¸¸è§çš„æœ‰ï¼šMIT, Apache-2.0, GPL-3.0, BSD-3-Clause ç­‰
  license "MIT"

  # ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼Œä½†æ¨èä½¿ç”¨ï¼‰
  # å¦‚æœå®šä¹‰äº† versionï¼Œå¯ä»¥åœ¨ url ä¸­ä½¿ç”¨ #{version} å¼•ç”¨
  # version "1.0.0"

  # ä¾èµ–å…³ç³»ï¼ˆå¯é€‰ï¼‰
  # å¦‚æœä½ çš„å·¥å…·éœ€è¦å…¶ä»–è½¯ä»¶æ‰èƒ½è¿è¡Œï¼Œåœ¨è¿™é‡Œå£°æ˜
  # depends_on "openssl"          # è¿è¡Œæ—¶ä¾èµ–
  # depends_on "cmake" => :build  # ä»…æ„å»ºæ—¶ä¾èµ–
  # depends_on "rust" => :build   # æ„å»ºæ—¶éœ€è¦ Rust

  # æ“ä½œç³»ç»Ÿé™åˆ¶ï¼ˆå¯é€‰ï¼‰
  # å¦‚æœä½ çš„å·¥å…·åªæ”¯æŒç‰¹å®šæ“ä½œç³»ç»Ÿï¼Œå¯ä»¥å£°æ˜
  # depends_on :macos             # ä»…æ”¯æŒ macOS
  # depends_on :linux             # ä»…æ”¯æŒ Linux

  # å®‰è£…æ–¹æ³•ï¼ˆå¿…å¡«ï¼‰
  # è¿™ä¸ªæ–¹æ³•å®šä¹‰äº†å¦‚ä½•å°†è½¯ä»¶å®‰è£…åˆ°ç³»ç»Ÿä¸­
  def install
    # å¯¹äºé¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€šå¸¸åªéœ€è¦å¤åˆ¶æ–‡ä»¶åˆ°å¯¹åº”ç›®å½•

    # bin.install: å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶åˆ° #{prefix}/bin/
    # ç”¨æˆ·å®‰è£…åå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨
    bin.install "my-app"

    # å¦‚æœæœ‰å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶
    # bin.install "my-app", "my-tool", "my-helper"

    # å¦‚æœæœ‰åº“æ–‡ä»¶ï¼Œå®‰è£…åˆ° lib ç›®å½•
    # lib.install Dir["lib/*"]

    # å¦‚æœæœ‰æ–‡æ¡£æ–‡ä»¶ï¼Œå®‰è£…åˆ° share/doc/<name>/ ç›®å½•
    # (share/"doc/my-app").install "README.md", "LICENSE"

    # å¦‚æœæœ‰ man æ‰‹å†Œé¡µ
    # man1.install "man/my-app.1"

    # å¦‚æœæœ‰é…ç½®æ–‡ä»¶ç¤ºä¾‹
    # (etc/"my-app").install "config/example.conf"
  end

  # æµ‹è¯•æ–¹æ³•ï¼ˆæ¨èï¼‰
  # è¿™ä¸ªæ–¹æ³•ç”¨äºéªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ
  # Homebrew ä¼šåœ¨å®‰è£…åè‡ªåŠ¨è¿è¡Œè¿™ä¸ªæµ‹è¯•
  test do
    # æœ€ç®€å•çš„æµ‹è¯•ï¼šæ£€æŸ¥ç‰ˆæœ¬å·è¾“å‡º
    assert_match version.to_s, shell_output("#{bin}/my-app --version")

    # æˆ–è€…æµ‹è¯•å¸®åŠ©å‘½ä»¤
    # system "#{bin}/my-app", "--help"

    # æˆ–è€…è¿è¡Œä¸€ä¸ªç®€å•çš„åŠŸèƒ½æµ‹è¯•
    # output = shell_output("#{bin}/my-app test-command")
    # assert_match "expected output", output

    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    # assert_predicate bin/"my-app", :exist?
  end
end

# ğŸ¯ ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿çš„å¿«é€Ÿæ¸…å•ï¼š
# â–¡ å°†ç±»å MyApp æ”¹ä¸ºä½ çš„åº”ç”¨åï¼ˆé©¼å³°å‘½åï¼‰
# â–¡ ä¿®æ”¹ desc ä¸ºä½ çš„åº”ç”¨æè¿°
# â–¡ ä¿®æ”¹ homepage ä¸ºä½ çš„é¡¹ç›®ä¸»é¡µ
# â–¡ ä¿®æ”¹ url ä¸ºå®é™…çš„ä¸‹è½½åœ°å€
# â–¡ ä½¿ç”¨ shasum -a 256 è®¡ç®— SHA256 å¹¶æ›¿æ¢
# â–¡ ä¿®æ”¹ license ä¸ºä½ çš„è®¸å¯è¯ç±»å‹
# â–¡ æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ install æ–¹æ³•
# â–¡ ç¼–å†™åˆé€‚çš„ test æ–¹æ³•
# â–¡ æµ‹è¯•å®‰è£…ï¼šbrew install --build-from-source ./Formula/your-formula.rb
# â–¡ è¿è¡Œæµ‹è¯•ï¼šbrew test your-formula
# â–¡ æ£€æŸ¥è§„èŒƒï¼šbrew audit --strict ./Formula/your-formula.rb
